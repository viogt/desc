<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <title>Upload an Excel File</title>
    <style>
        body {
            background-color: #ccc;
        }

        #percentage-text {
            font-size: 28px;
            font-weight: bold;
            fill: #6a6;
            text-anchor: middle;
        }

        .container {
            display: grid;
            max-width: 440px;
            margin: auto;
            padding: 24px;
            background-color: #fff;
            box-shadow: 0 4px 8px #888;
            border-radius: 16px;
            font: normal 15px Arial, sans-serif;
        }

        h2 {
            font:
                bold 24px Arial, sans-serif;
            color: green;
        }

        input[type="file"] {
            font-size: 16px;
        }

        svg,.deasupra {
            grid-area: 1 / 1;
        }
        svg {
            width: 50%;
            margin: 80px 0 0 50%;
        }

        ::file-selector-button {
            border: none;
            padding: 5px 1.2em;
            border-radius: 13px;
            background: linear-gradient(to bottom, #484, #242);
            color: #fff;
            transition: 0.2s;
        }

        b {
            background-image: url("data:image/svg+xml,%3Csvg fill='%23000000' width='64px' height='64px' viewBox='-3.5 0 19 19' xmlns='http://www.w3.org/2000/svg' class='cf-icon-svg'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Cpath d='M11.182 8.927v6.912a.794.794 0 0 1-.792.792H1.61a.794.794 0 0 1-.792-.792V8.927a.794.794 0 0 1 .792-.792h.856V6.367a3.534 3.534 0 1 1 7.068 0v1.768h.856a.794.794 0 0 1 .792.792zm-2.756-2.56a2.426 2.426 0 1 0-4.852 0v1.768h4.852zM7.108 11.47a1.108 1.108 0 1 0-1.583 1.001v1.849a.475.475 0 0 0 .95 0v-1.849a1.108 1.108 0 0 0 .633-1.001z'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 2px 0;
            background-size: 20px;
            font-weight: normal;
            background-color: #fa4;
            box-shadow: 0 2px 4px #666;
            padding: 2px 6px 2px 24px;
            border-radius: 6px;
        }

        b[lilac] {
            background-image: url("data:image/svg+xml,%3Csvg width='64px' height='64px' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000000'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Crect x='0' fill='none' width='20' height='20'%3E%3C/rect%3E%3Cg%3E%3Cpath d='M17.3 3.3c-.4-.4-1.1-.4-1.6 0l-2.4 2.4c-1.1-.4-2.2-.6-3.3-.6-3.8.1-7.2 2.1-9 5.4.2.4.5.8.8 1.2.8 1.1 1.8 2 2.9 2.7L3 16.1c-.4.4-.5 1.1 0 1.6.4.4 1.1.5 1.6 0L17.3 4.9c.4-.5.4-1.2 0-1.6zm-10.6 9l-1.3 1.3c-1.2-.7-2.3-1.7-3.1-2.9C3.5 9 5.1 7.8 7 7.2c-1.3 1.4-1.4 3.6-.3 5.1zM10.1 9c-.5-.5-.4-1.3.1-1.8.5-.4 1.2-.4 1.7 0L10.1 9zm8.2.5c-.5-.7-1.1-1.4-1.8-1.9l-1 1c.8.6 1.5 1.3 2.1 2.2C15.9 13.4 13 15 9.9 15h-.8l-1 1c.7-.1 1.3 0 1.9 0 3.3 0 6.4-1.6 8.3-4.3.3-.4.5-.8.8-1.2-.3-.3-.5-.7-.8-1zM14 10l-4 4c2.2 0 4-1.8 4-4z'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            background-color: #fe2;
        }

        img {
            width: 20px;
            height: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            padding: 12px;
            border-top: 0.8px solid #ccc;
        }

        td {
            border-bottom: 0.8px solid #ccc;
            padding: 6px;
        }

        #progress {
            width: 100%;
            height: 32px;
            background: #ded;
            margin: 20px 0;
            border-radius: 16px;
            overflow: hidden;
        }

        #bar {
            height: 100%;
            width: 0;
            background: linear-gradient(to bottom, #484, #242);
            transition: 0.2s;
            color: #fff;
            text-align: center;
            font:
                normal 16px/32px Arial,
                sans-serif;
        }

        span {
            color: #c00;
        }

        p {
            background-image: url("data:image/svg+xml,%3Csvg fill='%23008000' width='64px' height='64px' viewBox='-4 0 32 32' version='1.1' xmlns='http://www.w3.org/2000/svg' stroke='%23008000'%3E%3Cg id='SVGRepo_bgCarrier' stroke-width='0'%3E%3C/g%3E%3Cg id='SVGRepo_tracerCarrier' stroke-linecap='round' stroke-linejoin='round'%3E%3C/g%3E%3Cg id='SVGRepo_iconCarrier'%3E%3Ctitle%3Echeck%3C/title%3E%3Cpath d='M19.375 5.063l-9.5 13.625-6.563-4.875-3.313 4.594 11.188 8.531 12.813-18.375z'%3E%3C/path%3E%3C/g%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-size: 22px;
            margin: 0;
            padding: 4px 4px 4px 24px;
            /*transform: scale(1.2);*/
        }

        .fadeIn {
            animation: fadeIn 0.4s ease forwards;
        }

        @keyframes fadeIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <b>unlocked</b>&nbsp;<b lilac>hidden</b>
    <p>What a wonderfully worded.</p>
    <div class="container">
        <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#ccc" stroke-width="10" />
            <path id="percentage-arc" fill="none" stroke="#4CAF50" stroke-width="10" stroke-linecap="round" />
            <text id="percentage-text" x="50" y="60">0%</text>
        </svg>
        <div class="deasupra">
            <h2><img src="public/logo.png" />&nbsp;Upload an .xlsx file</h2>
            <input type="file" id="fileInput" accept=".xlsx" onchange="uploadFile()" />
            <div id="progress">
                <div id="bar"></div>
            </div>
            <div id="message"></div>
            <div id="rezultat"></div>
            </svg>
        </div>
        <button onclick="animateLoader(100)">Start 100% Load</button>
    </div>
    <script>
        const log = document.getElementById("message");
        const bar = document.getElementById("bar");
        const rezultat = document.getElementById("rezultat");
        const fileInput = document.getElementById("fileInput");

        function out(s) {
            setTimeout(() => {
                const el = document.createElement("p");
                el.innerHTML = s;
                log.appendChild(el);
                el.classList.add("fadeIn");
            }, 0);
        }

        let progress;
        const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${wsProtocol}//${window.location.host}`; //'ws://localhost:8080';
        const socket = new WebSocket(wsUrl);
        socket.onopen = e => {
            console.log('WebSocket connection established.');
        };
        socket.onmessage = e => {
            const js = JSON.parse(e.data);
            if (js.cod < 0) {
                rezultat.innerHTML = js.mssg;
                setTimeout(() => {
                    window.scroll({
                        top: document.body.scrollHeight,
                        behavior: "smooth",
                    });
                }, 500);
                return;
            }
            progress += js.cod; if (progress > 100) progress = 100;
            percent = progress + "%";
            bar.style.width = percent;
            bar.textContent = percent;
            const el = document.createElement("p");
            el.innerHTML = "<font color='green'>âœ”</font>&nbsp;" + js.mssg;
            log.appendChild(el);
            el.classList.add("fadeIn");
        };
        socket.onclose = event => {
            if (event.wasClean) {
                console.log(`Connection closed cleanly, code=${event.code} reason=${event.reason}`);
            } else {
                console.log('**CONNECTION DIED** (server or network error)');
            }
        };
        socket.onerror = error => {
            console.log(`WebSocket Error: ${error.message}`);
        };

        /*function sendMessage() {
            const message = input.value;
            if (message && socket.readyState === WebSocket.OPEN) {
                socket.send(message);
                logMessage(`SENT: ${message}`, 'blue');
                input.value = '';
            } else if (socket.readyState !== WebSocket.OPEN) {
                console.log('Cannot send: Connection is not open.');
            }
        }*/
        function uploadFile() {
            progress = 0;
            log.innerHTML = "";
            rezultat.innerHTML = "";
            const file = fileInput.files[0];
            console.log("Selected file:", file.name, file.size, "bytes");
            socket.send(file);
        }
        //----------------- SVG Loader Animation Code -----------------
        const CENTER_X = 50;
        const CENTER_Y = 50;
        const RADIUS = 45;

        const arcElement = document.getElementById('percentage-arc');
        const textElement = document.getElementById('percentage-text');

        function polarToCartesian(angleInDegrees) {
            const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
            return {
                x: CENTER_X + (RADIUS * Math.cos(angleInRadians)),
                y: CENTER_Y + (RADIUS * Math.sin(angleInRadians))
            };
        }

        function describeArc(percentage) {
            const endAngle = percentage * 3.6;
            const start = polarToCartesian(0);
            const end = polarToCartesian(endAngle);
            const largeArcFlag = endAngle <= 180 ? "0" : "1";
            const sweepFlag = "1";
            if (percentage === 100) {
                const d = [
                    `M ${start.x} ${start.y}`,
                    `A ${RADIUS} ${RADIUS} 0 1 1 ${start.x - 0.01} ${start.y}`
                ].join(' ');
                return d;
            }
            const d = [
                `M ${start.x} ${start.y}`,
                `A ${RADIUS} ${RADIUS} 0 ${largeArcFlag} ${sweepFlag} ${end.x} ${end.y}`
            ].join(' ');

            return d;
        }

        /**
         * Animates the loader from the current value to the target percentage.
         * @param {number} targetPercentage - The final percentage to display.
         */
        function animateLoader(targetPercentage) {
            let currentPercentage = 0;

            alert("Animatie inceputa");

            // Calculate the step size based on the duration (e.g., 20ms update interval)
            const duration = 1500; // 1.5 seconds total animation
            const frames = duration / 20;
            const step = targetPercentage / frames;

            function update() {
                currentPercentage += step;

                if (currentPercentage < targetPercentage) {
                    arcElement.setAttribute('d', describeArc(currentPercentage));
                    textElement.textContent = `${Math.round(currentPercentage)}%`;
                    setTimeout(update, 100);
                } else {
                    // Final update to ensure exact target value is hit
                    arcElement.setAttribute('d', describeArc(targetPercentage));
                    textElement.textContent = `${targetPercentage}%`;
                    console.log(`Animation complete at ${targetPercentage}%`);
                }
            }

            update();
        }

        // Initialize the loader arc to 0% on page load
        arcElement.setAttribute('d', describeArc(0));

        // Example of running the animation automatically:
        // animateLoader(75);
    </script>
</body>

</html>